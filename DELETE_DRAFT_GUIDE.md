# 删除草稿版本功能使用指南

## 功能概述

本功能允许用户删除处于草稿状态的版本，提供友好的交互体验和安全的确认机制。

## 功能特点

### 1. 双重确认机制
- **Popconfirm组件**：提供美观的确认对话框
- **详细信息展示**：显示要删除的版本号
- **风险提示**：明确告知用户删除后无法恢复

### 2. 加载状态反馈
- **按钮加载状态**：删除过程中按钮显示加载动画
- **禁用操作**：删除过程中禁用相关操作
- **状态管理**：防止重复提交

### 3. 错误处理
- **网络错误**：显示具体的错误信息
- **业务错误**：显示后端返回的错误消息
- **用户友好**：提供清晰的错误提示

## 使用位置

### 1. 版本管理面板 (VersionManagementPanel)
- **位置**：事件配置页面的版本管理区域
- **触发**：点击"删除草稿"按钮
- **确认**：Popconfirm确认对话框

### 2. 版本历史模态框 (VersionHistoryModal)
- **位置**：版本历史列表的操作列
- **触发**：点击草稿版本行的"删除"按钮
- **确认**：Popconfirm确认对话框

## 交互流程

```
用户点击删除 → 显示确认对话框 → 用户确认 → 执行删除 → 更新UI → 显示结果
```

### 确认对话框内容
- **标题**：确认删除草稿版本
- **描述**：
  - 确定要删除草稿版本 [版本号] 吗？
  - ⚠️ 删除后将无法恢复，请谨慎操作。
- **按钮**：取消 | 确认删除（危险色）

## API接口

### 删除草稿版本
```typescript
DELETE /api/event-config-version/{versionId}
```

**响应格式**：
```json
{
  "code": "SUCCESS",
  "message": "操作成功",
  "data": true
}
```

## 组件更新

### 1. VersionManagementPanel
- 添加了删除按钮的加载状态
- 使用Popconfirm提供确认交互
- 改进了草稿版本的信息展示

### 2. VersionHistoryModal
- 为草稿版本添加删除操作
- 支持批量删除的加载状态管理
- 删除后自动关闭模态框并刷新数据

### 3. 服务层 (eventConfigVersion.ts)
- 添加了`deleteDraftVersion` API调用
- 更新了`discardDraft`函数实现
- 统一的错误处理机制

## 测试页面

访问 `/version-test` 页面可以测试删除功能：
- 版本管理面板测试
- 版本历史模态框测试
- API调用测试

## 安全考虑

1. **权限控制**：只有草稿版本可以删除
2. **状态检查**：后端验证版本状态
3. **级联删除**：删除版本时同时删除相关配置
4. **审计日志**：保留变更历史记录

## 注意事项

1. **不可恢复**：删除操作不可撤销
2. **级联影响**：删除版本会同时删除相关配置
3. **审计保留**：变更历史记录不会被删除
4. **权限要求**：需要相应的删除权限

## 错误码

- `DRAFT_VERSION_EXISTS`：该事件已存在草稿版本
- `VERSION_EXISTS`：该事件的版本号已存在
- `NO_ACTIVE_VERSION`：该事件不存在生效版本
- `NOT_FOUND`：版本不存在或删除失败
- `SERVER_ERROR`：服务器内部错误
